
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeatherSphere - Your Personal Weather App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .weather-card {
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .day-mode {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        .night-mode {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }
        .ui-container {
            background-color: rgba(255, 255, 255, 0.9);
            color: #1f2937;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .input-field {
            background-color: rgba(255, 255, 255, 0.8);
            color: #1f2937;
        }
    </style>
</head>
<body class="min-h-screen day-mode transition-colors duration-300">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold mb-2 text-gray-800">WeatherSphere</h1>
            <p class="text-xl opacity-90 text-gray-600">Your personal weather companion</p>
        </header>

        <main>
            <div class="max-w-2xl mx-auto ui-container p-6 mb-8 transition-all duration-300">
                <div class="flex flex-col md:flex-row gap-4">
                    <input 
                        type="text" 
                        id="city-input" 
                        placeholder="Enter city name..." 
                        class="flex-grow px-4 py-3 rounded-lg input-field border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder-gray-500"
                    >
                    <button 
                        id="search-btn" 
                        class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-semibold transition-all duration-300 flex items-center justify-center gap-2"
                    >
                        <i class="fas fa-search"></i> Search
                    </button>
                    <button 
                        id="location-btn" 
                        class="px-4 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition-all duration-300 flex items-center justify-center"
                        title="Use my location"
                    >
                        <i class="fas fa-location-arrow"></i>
                    </button>
                </div>
            </div>

            <div id="error-message" class="hidden max-w-2xl mx-auto bg-red-500 text-white rounded-xl p-4 mb-8 text-center">
                <p class="font-medium">City not found. Please try another location.</p>
            </div>

            <div id="loading" class="hidden max-w-2xl mx-auto text-center py-8">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"></div>
                <p class="text-gray-700">Loading weather data...</p>
            </div>

            <div id="weather-container" class="hidden max-w-4xl mx-auto">
                <div class="ui-container rounded-xl shadow-xl overflow-hidden transition-all duration-300">
                    <div class="p-6 md:p-8">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                            <div>
                                <h2 id="city-name" class="text-3xl font-bold text-gray-800"></h2>
                                <p id="current-date" class="opacity-90 text-gray-600"></p>
                            </div>
                            <div class="mt-4 md:mt-0 flex items-center gap-2">
                                <button id="unit-toggle" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all duration-300">
                                    <span id="temp-unit">°C</span> / <span id="temp-unit-alt">°F</span>
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="weather-card bg-blue-50 rounded-xl p-6 flex flex-col items-center">
                                <div id="weather-icon" class="text-8xl mb-4"></div>
                                <p id="weather-description" class="text-xl font-medium capitalize mb-2 text-gray-700"></p>
                                <p id="current-temp" class="text-5xl font-bold mb-2 text-gray-800"></p>
                                <p id="feels-like" class="opacity-90 text-gray-600"></p>
                            </div>

                            <div class="weather-card bg-blue-50 rounded-xl p-6">
                                <h3 class="text-xl font-semibold mb-4 text-gray-800">Details</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="opacity-90 text-gray-700"><i class="fas fa-wind mr-2"></i> Wind</span>
                                        <span id="wind-speed" class="font-medium text-gray-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="opacity-90 text-gray-700"><i class="fas fa-tint mr-2"></i> Humidity</span>
                                        <span id="humidity" class="font-medium text-gray-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="opacity-90 text-gray-700"><i class="fas fa-compress-alt mr-2"></i> Pressure</span>
                                        <span id="pressure" class="font-medium text-gray-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="opacity-90 text-gray-700"><i class="fas fa-eye mr-2"></i> Visibility</span>
                                        <span id="visibility" class="font-medium text-gray-800"></span>
                                    </div>
                                </div>
                            </div>

                            <div class="weather-card bg-blue-50 rounded-xl p-6">
                                <h3 class="text-xl font-semibold mb-4 text-gray-800">Sun & More</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="opacity-90 text-gray-700"><i class="fas fa-sun mr-2"></i> Sunrise</span>
                                        <span id="sunrise" class="font-medium text-gray-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="opacity-90 text-gray-700"><i class="fas fa-moon mr-2"></i> Sunset</span>
                                        <span id="sunset" class="font-medium text-gray-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="opacity-90 text-gray-700"><i class="fas fa-cloud mr-2"></i> Clouds</span>
                                        <span id="cloudiness" class="font-medium text-gray-800"></span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="opacity-90 text-gray-700"><i class="fas fa-thermometer-half mr-2"></i> Dew Point</span>
                                        <span id="dew-point" class="font-medium text-gray-800"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <h3 class="text-2xl font-bold mt-10 mb-6 text-center text-gray-800">5-Day Forecast</h3>
                <div id="forecast-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 mb-8"></div>
            </div>
        </main>

        <footer class="text-center mt-12 opacity-80 text-sm text-gray-600">
            <p>© 2023 WeatherSphere | Powered by OpenWeatherMap</p>
        </footer>
    </div>

    <script>
        // API Key - Normally you would want to hide this in a backend service
        const API_KEY = 'a8e71c9932b20c4ceb0aed183e6a83bb';
        let currentUnit = 'metric'; // Default to Celsius
        let currentWeatherData = null;

        // DOM Elements
        const cityInput = document.getElementById('city-input');
        const searchBtn = document.getElementById('search-btn');
        const locationBtn = document.getElementById('location-btn');
        const unitToggle = document.getElementById('unit-toggle');
        const weatherContainer = document.getElementById('weather-container');
        const errorMessage = document.getElementById('error-message');
        const loading = document.getElementById('loading');
        const body = document.body;

        // Weather display elements
        const cityName = document.getElementById('city-name');
        const currentDate = document.getElementById('current-date');
        const weatherIcon = document.getElementById('weather-icon');
        const weatherDescription = document.getElementById('weather-description');
        const currentTemp = document.getElementById('current-temp');
        const feelsLike = document.getElementById('feels-like');
        const windSpeed = document.getElementById('wind-speed');
        const humidity = document.getElementById('humidity');
        const pressure = document.getElementById('pressure');
        const visibility = document.getElementById('visibility');
        const sunrise = document.getElementById('sunrise');
        const sunset = document.getElementById('sunset');
        const cloudiness = document.getElementById('cloudiness');
        const dewPoint = document.getElementById('dew-point');
        const forecastContainer = document.getElementById('forecast-container');
        const tempUnit = document.getElementById('temp-unit');
        const tempUnitAlt = document.getElementById('temp-unit-alt');

        // Event Listeners
        searchBtn.addEventListener('click', () => {
            const city = cityInput.value.trim();
            if (city) {
                fetchWeatherData(city);
            }
        });

        cityInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const city = cityInput.value.trim();
                if (city) {
                    fetchWeatherData(city);
                }
            }
        });

        locationBtn.addEventListener('click', getLocationWeather);

        unitToggle.addEventListener('click', toggleTemperatureUnit);

        // Functions
        function updateBackgroundBasedOnTime(sunriseTime, sunsetTime) {
            const now = new Date();
            const currentTime = now.getTime() / 1000; // Convert to Unix timestamp
            
            // Check if current time is between sunset and sunrise (night time)
            if (currentTime < sunriseTime || currentTime > sunsetTime) {
                body.classList.remove('day-mode');
                body.classList.add('night-mode');
            } else {
                body.classList.remove('night-mode');
                body.classList.add('day-mode');
            }
        }

        async function fetchWeatherData(city) {
            try {
                showLoading();
                hideError();
                
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=${currentUnit}`);
                
                if (!response.ok) {
                    throw new Error('City not found');
                }
                
                const data = await response.json();
                currentWeatherData = data;
                
                // Update background based on day/night in the searched city
                updateBackgroundBasedOnTime(data.sys.sunrise, data.sys.sunset);
                
                const forecastResponse = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${API_KEY}&units=${currentUnit}`);
                const forecastData = await forecastResponse.json();
                
                displayWeather(data);
                displayForecast(forecastData);
                
                hideLoading();
                showWeather();
            } catch (error) {
                console.error('Error fetching weather data:', error);
                hideLoading();
                showError();
            }
        }

        function getLocationWeather() {
            if (navigator.geolocation) {
                showLoading();
                hideError();
                
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        try {
                            const { latitude, longitude } = position.coords;
                            
                            const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${API_KEY}&units=${currentUnit}`);
                            const data = await response.json();
                            currentWeatherData = data;
                            
                            // Update background based on day/night in the searched location
                            updateBackgroundBasedOnTime(data.sys.sunrise, data.sys.sunset);
                            
                            const forecastResponse = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${latitude}&lon=${longitude}&appid=${API_KEY}&units=${currentUnit}`);
                            const forecastData = await forecastResponse.json();
                            
                            displayWeather(data);
                            displayForecast(forecastData);
                            
                            hideLoading();
                            showWeather();
                        } catch (error) {
                            console.error('Error fetching weather data:', error);
                            hideLoading();
                            showError();
                        }
                    },
                    (error) => {
                        console.error('Geolocation error:', error);
                        hideLoading();
                        alert('Unable to retrieve your location. Please enable location services or enter a city manually.');
                    }
                );
            } else {
                alert('Geolocation is not supported by your browser. Please enter a city manually.');
            }
        }

        function displayWeather(data) {
            cityName.textContent = `${data.name}, ${data.sys.country}`;
            
            const now = new Date();
            currentDate.textContent = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const weatherMain = data.weather[0].main;
            weatherDescription.textContent = data.weather[0].description;
            
            // Set weather icon
            const iconCode = data.weather[0].icon;
            weatherIcon.innerHTML = getWeatherIcon(iconCode);
            
            // Temperature and other metrics
            currentTemp.textContent = `${Math.round(data.main.temp)}°${currentUnit === 'metric' ? 'C' : 'F'}`;
            feelsLike.textContent = `Feels like: ${Math.round(data.main.feels_like)}°${currentUnit === 'metric' ? 'C' : 'F'}`;
            windSpeed.textContent = `${currentUnit === 'metric' ? `${data.wind.speed} m/s` : `${(data.wind.speed * 2.237).toFixed(1)} mph`}`;
            humidity.textContent = `${data.main.humidity}%`;
            pressure.textContent = `${data.main.pressure} hPa`;
            visibility.textContent = `${data.visibility / 1000} km`;
            
            // Sunrise and sunset times
            const sunriseTime = new Date(data.sys.sunrise * 1000);
            const sunsetTime = new Date(data.sys.sunset * 1000);
            
            sunrise.textContent = sunriseTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            sunset.textContent = sunsetTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            cloudiness.textContent = `${data.clouds.all}%`;
            dewPoint.textContent = `${Math.round(data.main.temp_min)}°${currentUnit === 'metric' ? 'C' : 'F'}`;
        }

        function displayForecast(data) {
            // Filter to get one forecast per day (every 24 hours)
            const dailyForecasts = [];
            const daysAdded = new Set();
            
            for (let i = 0; i < data.list.length; i++) {
                const forecast = data.list[i];
                const date = new Date(forecast.dt * 1000);
                const day = date.toLocaleDateString([], { weekday: 'short' });
                
                if (!daysAdded.has(day) && date.getHours() >= 12) {
                    daysAdded.add(day);
                    dailyForecasts.push(forecast);
                    
                    if (dailyForecasts.length === 5) break;
                }
            }
            
            forecastContainer.innerHTML = '';
            
            dailyForecasts.forEach(forecast => {
                const date = new Date(forecast.dt * 1000);
                const day = date.toLocaleDateString([], { weekday: 'short' });
                const iconCode = forecast.weather[0].icon;
                
                const forecastCard = document.createElement('div');
                forecastCard.className = 'weather-card bg-blue-50 rounded-xl p-4 text-center fade-in';
                forecastCard.innerHTML = `
                    <p class="font-semibold mb-2 text-gray-700">${day}</p>
                    <div class="text-5xl my-3">${getWeatherIcon(iconCode)}</div>
                    <div class="flex justify-center gap-4">
                        <span class="font-bold text-gray-800">${Math.round(forecast.main.temp_max)}°</span>
                        <span class="opacity-80 text-gray-600">${Math.round(forecast.main.temp_min)}°</span>
                    </div>
                    <p class="mt-2 text-sm capitalize text-gray-700">${forecast.weather[0].description}</p>
                `;
                
                forecastContainer.appendChild(forecastCard);
            });
        }

        function getWeatherIcon(iconCode) {
            const iconMap = {
                '01d': 'fas fa-sun text-yellow-400',         // clear sky day
                '01n': 'fas fa-moon text-blue-200',        // clear sky night
                '02d': 'fas fa-cloud-sun text-yellow-400',   // few clouds day
                '02n': 'fas fa-cloud-moon text-blue-200',  // few clouds night
                '03d': 'fas fa-cloud text-gray-400',       // scattered clouds day
                '03n': 'fas fa-cloud text-gray-400',      // scattered clouds night
                '04d': 'fas fa-cloud text-gray-500',       // broken clouds day
                '04n': 'fas fa-cloud text-gray-500',      // broken clouds night
                '09d': 'fas fa-cloud-rain text-blue-400',  // shower rain day
                '09n': 'fas fa-cloud-rain text-blue-400', // shower rain night
                '10d': 'fas fa-cloud-sun-rain text-blue-400', // rain day
                '10n': 'fas fa-cloud-moon-rain text-blue-400', // rain night
                '11d': 'fas fa-bolt text-yellow-400',       // thunderstorm day
                '11n': 'fas fa-bolt text-yellow-400',      // thunderstorm night
                '13d': 'fas fa-snowflake text-blue-200',   // snow day
                '13n': 'fas fa-snowflake text-blue-200',  // snow night
                '50d': 'fas fa-smog text-gray-400',       // mist day
                '50n': 'fas fa-smog text-gray-400'       // mist night
            };
            
            return `<i class="${iconMap[iconCode] || 'fas fa-question'}"></i>`;
        }

        function toggleTemperatureUnit() {
            currentUnit = currentUnit === 'metric' ? 'imperial' : 'metric';
            
            // Update button text
            tempUnit.textContent = currentUnit === 'metric' ? '°C' : '°F';
            tempUnitAlt.textContent = currentUnit === 'metric' ? '°F' : '°C';
            
            // If we have weather data, refresh it with new units
            if (currentWeatherData) {
                fetchWeatherData(currentWeatherData.name);
            }
        }

        function showLoading() {
            loading.classList.remove('hidden');
            weatherContainer.classList.add('hidden');
        }

        function hideLoading() {
            loading.classList.add('hidden');
        }

        function showWeather() {
            weatherContainer.classList.remove('hidden');
        }

        function showError() {
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        // Initialize with default city
        window.addEventListener('load', () => {
            fetchWeatherData('London');
        });
    </script>
</body>
</html>